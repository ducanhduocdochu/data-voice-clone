const fs = require('fs');

const inputText = `Tôi gặp Chu Hải Yến năm tôi 14 tuổi.

Vì suy dinh dưỡng lâu ngày nên tôi vừa thấp bé vừa gầy gò, nhỏ hơn bạn bè cùng trang lứa rất nhiều. Từ khi tôi bắt đầu có ký ức thì ba tôi đã không có việc làm, suốt ngày lêu lổng.

Một nhà ba người chúng tôi sống dựa vào tiền lương 3000 tệ của mẹ ở xưởng may.

Ba tôi nghiện cờ bạc, nhưng mười lần đánh bạc thì chín lần thua. Một khi đã thua thì tâm trạng không tốt, tâm trạng không tốt thì uống rượu, uống say thì bắt đầu đánh vợ con.

Trên sàn nhà thường xuyên có mảnh chén bát vỡ, thức ăn thừa vung vãi.

Năm tôi 5 tuổi, ông ta thua rất nhiều tiền.

Tối đến, người nồng nặc mùi rượu, ông ta nắm tóc mẹ tôi, đẩy bà ngã trên nền xi măng, đè nghiến mặt bà xuống đất, đè mệt thì đổi chân đá vào bụng bà.

“Mẹ kiếp có phải mày cho là ông đây bất tài, khinh thường ông không? Hả?

Đồ đi*m thúi, không sinh được ‘hạt giống’ cho ông, ông mày ra ngoài không dám ngẩng mặt lên nhìn ai! Mày ảnh hưởng vận số của ông, lúc trước nếu không cưới mày thì bây giờ ông đây đã giàu có rồi.”

Mẹ bị đánh nằm cuộn tròn trên đất. Máu đỏ thẫm bết lấy mái tóc đen của bà, kết thành từng nùi. Bà không né tránh, cũng không phản kháng, khờ dại cố gắng chịu đựng hòng đánh thức lương tri cuối cùng của người đàn ông.

Trên người mẹ không còn khoảng da thịt nào lành lặn có thể xuống tay. Ông ta chuyển ánh mắt sang nhìn chằm chằm tôi.

“Còn con quỷ cái này nữa, con đi*m lớn sinh ra một con đi*m nhỏ. Mày nhìn ông với ánh mắt gì hả? Sao? Muốn đánh tao?”

Một cái tát nặng nề giáng thẳng vào mặt tôi, sau cơn đau đớn là tê dại.

Tựa như tất cả những âm thanh xung quanh được cho vào lớp vỏ thủy tinh, hoàn toàn ngăn cách với bên ngoài.

Tôi bị tát đến thủng màng nhĩ.

Mẹ khóc, ôm tôi giấu vào lòng, dùng tấm thân gầy guộc thay tôi gánh gió mưa.

Tiếng chửi rủa của người đàn ông, tiếng khóc lóc thê thảm của người phụ nữ kết thúc bằng sự kiệt sức của thủ phạm.

Nửa đêm, tiếng ngáy đàn ông xen lẫn với tiếng nức nở của phụ nữ.

Mắt mẹ đỏ hoe bôi thuốc cho tôi, lặng lẽ dọn dẹp đống hỗn độn trên mặt đất. Hai chúng tôi rúc vào chiếc giường nhỏ, bà ôm chặt tôi.

Tôi nói: “Mẹ, chúng ta rời khỏi đây được không, sau này con sẽ kiếm rất nhiều rất nhiều tiền nuôi mẹ.”

Bà nhìn ánh trăng ngoài cửa sổ, nơi đó khuyết mất một mảnh.

“Không đi đâu cả, ngày xưa ba đối xử với mẹ rất tốt. Ba dành dụm tiền mua cho mẹ chiếc vòng tay bằng vàng, sẽ cõng mẹ đi mấy dặm đường để xem pháo hoa, ông ấy còn mua cho mẹ rất nhiều quần áo đẹp để mặc, mẹ mặc còn không hết.”

Tôi giơ tay nắm lấy bộ quần áo đã giặt đến bạc màu, biến dạng của mẹ. “Mẹ, mẹ nói dối.”

Bà xoa đầu tôi, giọng cố chấp. “Mẹ không nói dối, bây giờ ba chỉ là nhất thời nông nỗi, ông ấy sẽ thay đổi, ông ấy đã từng nói sẽ đối xử tốt với mẹ cả đời này. Giống như ánh trăng ngoài cửa sổ, một ngày nào đó sẽ tròn.”

Bà lẩm bẩm, như đang nói cho tôi nghe, mà cũng như đang nói với chính mình.

Ngày hôm sau ba tỉnh rượu, lại như không có việc gì mà nói nói cười cười với mẹ, xòe tay đòi tiền.

Ông ta nói, Uyển Nhu, anh vẫn yêu em, thỉnh thoảng anh đi chơi vì vui nên quá chén, có lỗi với em, em đưa anh ít tiền, nếu thắng anh sẽ cho em một cuộc sống tốt đẹp.

Chỉ dăm ba câu đã dỗ được mẹ ngoan ngoãn đưa hết tiền lương ra cho ông ta.

Cảnh tượng quen thuộc này làm người ta sợ hãi.

Tôi nhìn nắm tiền trong tay ba, rất muốn hỏi mẹ, không phải mẹ hứa tháng này có lương sẽ cho tôi đi nhà trẻ sao?

Tôi đã 5 tuổi mà chưa từng đi nhà trẻ.

Nhưng mẹ cười rất hạnh phúc, trong mắt bà chỉ có ba, hoàn toàn quên mất tôi. Vì vậy, tôi ngậm miệng im lặng.

Không sao, tháng sau chắc chắn mẹ sẽ nhớ tới tôi.

Mãi đến khi tôi vào tiểu học theo chuơng trình phổ cập quốc gia, mẹ cũng không nhớ đến tôi.

Cứ thế, tôi bỏ lỡ hết những năm nhà trẻ.`

// Gộp thành 1 dòng, loại bỏ xuống dòng, dư khoảng trắng
const text = inputText.replace(/\s*\n\s*/g, ' ').replace(/\s+/g, ' ').trim()
console.log(text)
const textV1 = text.replace(/.”/g, '”').trim();
const textV2 = textV1.replace(/”/g, '”.').trim();
// const textV2 = textV1.replace(/../g, '.').trim()

console.log(textV2)
// Split thành mảng câu (câu kết thúc bằng . ? ! hoặc ... hoặc dấu tương tự có thể có dấu ngoặc kép)
const sentenceRegex = /.*?[.!?…””"']+(?=\s|$)/g;
const sentences = textV2.match(sentenceRegex) || [];

// Gom các câu thành đoạn <= 499 ký tự, luôn kết thúc ở dấu câu
const maxLen = 499;
const chunks = [];
let current = '';


for (const sentence of sentences) {
  if ((current + '' + sentence).trim().length <= maxLen) {
    current = (current + '' + sentence).trim();
  } else {
    if (current) chunks.push(current);
    current = sentence.trim();
  }
}
if (current) chunks.push(current);

// Lưu từng đoạn vào file riêng
chunks.forEach((chunk, idx) => {
  const filename = `split/output_${idx + 1}.txt`;
  fs.writeFileSync(filename, chunk, 'utf8');
  console.log(`Đã ghi ${filename}`);
});